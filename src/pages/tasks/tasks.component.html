<h1>Задача</h1>

<form [formGroup]="taskForm" (ngSubmit)="addTask()">
    <fieldset>
        <legend>Имя задачи*</legend>
        <div>
          <input type="text" name="name" formControlName="name"><br>
        </div>
        <div *ngIf="taskForm.controls['name'].invalid && taskForm.controls['name'].touched">
          <p>ИМЯ указано неверно!</p>
        </div>
      </fieldset>
    <fieldset>
        <legend>Описание</legend>
        <div>
          <textarea name="description" formControlName="description" rows="5" cols="50"></textarea>
        </div>
    </fieldset>
    <fieldset>
        <legend>К проекту*</legend>
        <div *ngFor="let project of projects">
            <label>{{project.name}}</label>
            <input type="radio" name="project" formControlName="project" value={{project.name}}><br>
        </div>
        <div *ngIf="taskForm.controls['project'].invalid">
          <p>ПРОЕКТ является обязательным полем для заполнения!</p>
        </div>
        <div *ngIf="projects.length == 0">
          <p>Для заполнения формы ЗАДАЧА, необходимо создать ПРОЕКТ в форме ПРОЕКТ!</p>
        </div>
    </fieldset>
    <fieldset>
        <legend>Приоритет*</legend>
        <select name="priority" formControlName="priority">
          <option *ngFor="let p of priority" [value]="p">
            {{p}}
          </option>
        </select>
        <div *ngIf="taskForm.controls['priority'].invalid">
          <p>ПРИОРИТЕТ является обязательным полем для заполнения!</p>
        </div>
      </fieldset>
      <fieldset>
        <legend>Статус*</legend>
        <select name="status" formControlName="status">
          <option *ngFor="let s of status" [value]="s">
            {{s}}
          </option>
        </select>
        <div *ngIf="taskForm.controls['status'].invalid">
          <p>Статус является обязательным полем для заполнения!</p>
        </div>
      </fieldset>
      <fieldset>
        <legend>Исполнитель*</legend>
        <div *ngFor="let c of commands">
          <fieldset>
            <label>Команда: {{c.name}}</label>
            <select name="executor" formControlName="executor">
              <option *ngFor="let par of c.participants" [ngValue]="par">
                {{par.name}} {{par.surname}} {{par.patronymic}}
              </option>
            </select>
          </fieldset>
        </div>
        <div *ngIf="taskForm.controls['executor'].invalid">
          <p>ИСПОЛНИТЕЛЬ является обязательным полем для заполнения!</p>
        </div>
        <div *ngIf="commands.length == 0">
          <p>Для заполнения пункта ИСПОЛНИТЕЛЬ, необходимо создать КОМАНДУ в форме КОМАНДА!</p>
        </div>
      </fieldset>
      <div>
      <button *ngIf="edit == false; else edited" type="submit" [disabled]="taskForm.invalid">Сохранить</button>
      <ng-template #edited>
        <button #edited type="button" (click)="editTask(taskForm.value.index)">Сохранить изменения</button>
      </ng-template>
      <button type="button" (click)="viewProjects()" [disabled]="edit">Перейти к проектам</button>
      <button type="button" (click)="viewCommands()" [disabled]="edit">Перейти к командам</button>
    </div>
</form>

<div *ngIf="tasks.length != 0">
  <h2>Задачи проектов</h2>
  <div *ngFor="let task of tasks">
    <fieldset>
      <legend>{{task.name}}</legend>
      <p>Проект: {{task.project.name}}</p>
      <p>Описание: {{task.description}}</p>
      <p>Статус: {{task.status}}</p>
      <p>Приоритет: {{task.priority}}</p>
      <p>Исполнитель: {{task.executor.name}} {{task.executor.surname}} {{task.executor.patronymic}} команды {{task.executor.command.name}}</p>
      <button type="button" (click)="editTask(task.index)" [disabled]="edit">Изменить</button>
      <button type="button" (click)="deleteTask(task.index)" [disabled]="edit">Удалить</button>
    </fieldset>
  </div>
</div>

